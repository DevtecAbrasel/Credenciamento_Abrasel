<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Lista de Eventos </title>
  <link rel='stylesheet' href='https://s3-us-west-2.amazonaws.com/s.cdpn.io/5028/basics_3.css'>
  <link rel="stylesheet" href="./style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
  <!-- partial:index.partial.html -->
  <!DOCTYPE html>
  <html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles\style-list-eventos.css">
    <script src="list-eventos.js"></script>
    <title>Lista de Eventos</title>
  </head>

  <body>
    <canvas class="orb-canvas"></canvas>

    <table class="responsive-table">

      <div class="all">
        <div class="buttons">
          <div class="one">
            <a href="landing-page.html"><button class="curve overlay__btn overlay__btn--colors">Voltar</button></a>
          </div>
        </div>
        <div class="buttons">
          <div class="one">
            <a href="index.html"><button class="curve overlay__btn overlay__btn--colors">Sair</button></a>
          </div>
        </div>
      </div>

      <h1>Lista de Eventos</h1>
      <button id="openModalBtn" class="overlay__btn overlay__btn--colors">Adicionar Evento</button>
      <br>
      <thead>
        <tr>
          <th scope="col">Nome do Evento</th>
          <th scope="col">Data</th>
          <th scope="col">Horario</th>
          <th scope="col">S/R</th>
          <th scope="col">Local</th>
          <th scope="col">Valor</th>
          <th scope="col">Limite de pessoas</th>
          <th scope="col">Mapa de mesas</th>
          <th scope="col">Adicionar recepcionista</th>
          <th scope="col">Lista de convidados</th>
        </tr>
      </thead>
      <tfoot>
        <tr></tr>
      </tfoot>
      <tbody id="eventTableBody">
        <tr>
          <th scope="row">Evento check-in</th>
          <td data-title="Data">17/10/2023</td>
          <td data-title="Horario">15:00-18:00</td>
          <td data-title="S/R" data-type="currency">Sec</td>
          <td data-title="Local" data-type="currency">BH</td>
          <td data-title="Valor" data-type="currency">R$0,00</td>
          <td data-title="Limite de pessoas" data-type="currency">500</td>
          <td data-title="Mapa de mesas" data-type="currency"><button
              class="overlay__btn overlay__btn--colors">
              <a href="mapa-de-mesas.html">
                Mesas
              </a>
            </button></td>
          <td data-title="Adicionar recepsionistam" data-type="currency"><button
              class="overlay__btn overlay__btn--colors">
              <a href="add-recep.html">
                Recepsionista
              </a>
            </button></td>
        </tr>
      </tbody>
    </table>

    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeModalBtn">&times;</span>
        <h2>Adicionar Novo Evento</h2>
        <!-- Formulário para adicionar um novo evento -->
        <form id="addMovieForm">
          <br>
          <label for="nomeEvento">Nome do Evento:</label>
          <input type="text" id="nomeEvento" name="nomeEvento" class="text-input" required>
          <br>
          <label for="data">Data:</label>
          <input type="date" id="data" name="data" class="text-input" required>
          <br>
          <label for="horario">Horario:</label>
          <input type="text" id="horario" name="horario" class="text-input" required>
          <br>
          <label for="sR">S/R:</label>
          <input type="text" id="sR" name="sR" class="text-input" required>
          <br>
          <label for="local">Local:</label>
          <input type="text" id="local" name="local" class="text-input" required>
          <br>
          <label for="valor">Valor:</label>
          <input type="text" id="valor" name="valor" class="text-input" required>
          <br>
          <label for="limitePessoas">Limite de pessoas:</label>
          <input type="text" id="limitePessoas" name="limitePessoas" class="text-input" required>
          <br>
          <br>
          <button type="submit" class="overlay__btn overlay__btn--colors">Adicionar</button>
        </form>
      </div>
    </div>

  </body>

  </html>
  <!-- partial -->
  <script type="module" src="list-eventos.js"></script>
  <script src="config/script-event.js"></script>
  <script>
    window.addEventListener("DOMContentLoaded", (event) => {
      document.getElementById("openModalBtn").addEventListener("click", function() {
        document.getElementById("modal").style.display = "block";
      });

      document.getElementById("closeModalBtn").addEventListener("click", function() {
        document.getElementById("modal").style.display = "none";
      });

      document.getElementById("addMovieForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const nomeEvento = document.getElementById("nomeEvento").value;
        const data = document.getElementById("data").value;
        const horario = document.getElementById("horario").value;
        const sR = document.getElementById("sR").value;
        const local = document.getElementById("local").value;
        const valor = document.getElementById("valor").value;
        const limitePessoas = document.getElementById("limitePessoas").value;

        const newEvent = {
          nomeEvento: nomeEvento,
          data: data,
          horario: horario,
          sR: sR,
          local: local,
          valor: valor,
          limitePessoas: limitePessoas,
        };

        const apiUrl = "http://localhost:8080/v1/event";
        fetch(apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${localStorage.getItem("token")}`,
          },
          body: JSON.stringify(newEvent),
        })
          .then(response => {
            if (!response.ok) {
              throw new Error(`Erro na requisição: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            console.log("Evento adicionado com sucesso:", data);

            document.getElementById("modal").style.display = "none";
            document.getElementById("addMovieForm").reset();
          })
          .catch(error => {
            console.error("Erro durante a requisição fetch:", error.message);
          });
      });

      fetchEvents();
    });
    
  </script>
</body>

</html>
